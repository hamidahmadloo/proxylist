<!doctype html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>دنیای بدون مرز تلگرام</title>

<!-- Font -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rastikerdar/IRANSans@v5.0.0/dist/font-face.css">

<!-- Flag Icons CDN -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flag-icons/css/flag-icons.min.css">

<!-- QRCode CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
:root {
  --day-bg: #F3FBFE;
  --day-card: #93cdeb;
  --day-surface: #6dbae3;
  --day-light: #45a7db;

  --night-bg: #1b2a3b;
  --night-card: #223549;
  --night-surface: #2a3b53;
  --night-light: #3b4c6b;

  --btn-connect-day: #0088cc;
  --btn-copy-day: #00aaff;
  --btn-qr-day: #00ccff;

  --btn-connect-night: #3399ff;
  --btn-copy-night: #66ccff;
  --btn-qr-night: #99ddff;

  --text-day: #111;
  --text-night: #f8fafc;
}

body {
  font-family: 'IRANSans', sans-serif;
  margin:0;
  background: var(--day-bg);
  color: var(--text-day);
}
body.theme-dark {
  background: var(--night-bg);
  color: var(--text-night);
}

.btn-welcome {
margin-top: 8px;
    padding: 4px 10px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    background: #0088cc;
    color: white;
    font-weight: 600;
    font-family: 'IRANSans';
}

/* Header */
.header { display:flex; align-items:center; justify-content:space-between; padding:12px 16px; background: #0088cc; flex-wrap:wrap; color:white; }
body.theme-dark .header { background: #223549; color:white; }
.brand { display:flex; flex-direction:column; gap:4px; }
.brand-main { display:flex; align-items:center; gap:8px; font-weight:700; font-size:20px; }
.brand-main .logo { width:36px;height:36px;background:#00aaff;display:grid;place-items:center;color:white;border-radius:6px; }
.brand-sub { font-size:14px; color:white; opacity:0.8; }

/* دکمه حالت شب/روز */
#themeToggle {
  background: #00aaff;
  color: #fff;
  border: none;
  padding: 6px 12px;
  border-radius: 6px;
  cursor: pointer;
}
body.theme-dark #themeToggle {
  background: #3399ff;
  color: #fff;
}

/* Tabs */
.tabs { display:flex; gap:12px; margin-top:10px; border-bottom:1px solid #ccc; flex-wrap:wrap; }
body.theme-dark .tabs { border-color:#555; }
.tab { cursor:pointer; padding:6px 14px; border-radius:6px; }
.tab.active { font-weight:700; border-bottom:2px solid #f97316; }

/* Stats */
.stats { display:flex; gap:12px; flex-wrap:wrap; margin-top:8px; }
.stat { padding:8px 12px; border-radius:10px; background: var(--day-surface); box-shadow:0 2px 6px rgba(0,0,0,0.1); }
body.theme-dark .stat { background: var(--night-surface); }

/* Grid */
.grid { display:grid; gap:16px; margin-top:16px; grid-template-columns: repeat(auto-fit,minmax(300px,1fr)); }
.card { border-radius:14px; background: var(--day-card); padding:12px; display:grid; gap:8px; }
body.theme-dark .card { background: var(--night-card); }
.card-header { display:flex; align-items:center; gap:8px; flex-wrap:wrap; justify-content:space-between; color:white; }
.badge { font-size:12px; padding:2px 6px; border-radius:8px; background:#0088cc; }
body.theme-dark .badge { background:#444; color:#fff; }
.kvs { display:grid; grid-template-columns:1fr 1fr; gap:4px; }
.kv { display:flex; align-items:center; gap:4px; padding:4px 6px; border-radius:6px; background: var(--day-surface); font-size:13px; flex-wrap:wrap; color:white; }
body.theme-dark .kv { background: var(--night-surface); }

/* Actions */
.actions { display:flex; gap:6px; flex-wrap:wrap; justify-content:center; }
.actions .btn { height:36px; min-width: 70px; display: inline-flex; align-items: center; justify-content: center; text-decoration: none }

/* Buttons */
.btn { cursor:pointer; border-radius:6px; border:none; display:inline-flex; align-items:center; gap:4px; font-family:'IRANSans',sans-serif; text-align:center; color:white; text-decoration:none; }

/* Pagination */
.pagination { display:flex; justify-content:center; gap:8px; margin-top:16px; flex-wrap:wrap; }
.page-btn { cursor:pointer; padding:6px 10px; border-radius:6px; display:inline-flex; align-items:center; gap:4px; color:white; font-family:'IRANSans',sans-serif; font-weight:600; }
.page-btn.day { background:#0088cc; }
.page-btn.night { background:#3399ff; }
.page-btn.active { border:2px solid #facc15; }

/* Footer */
.footer { text-align:center; padding:16px; margin-top:20px; }
.footer a { color:inherit; text-decoration:none; display:inline-flex; align-items:center; gap:4px; }

/* QR Modal */
#qrModal {
  position: fixed;
  inset: 0;
  display: none;
  place-items: center;
  background: rgba(0,0,0,0.5);
  z-index: 999;
}
#qrModal .popupContent {
  background: var(--day-card);
  padding: 0;
  border-radius: 12px;
  display: grid;
  place-items: center;
  width: 220px;
  height: 220px;
}
body.theme-dark #qrModal .popupContent {
  background: var(--night-card);
  color: var(--text-night);
}
#qrModal button {
  margin-top: 8px;
  padding: 4px 10px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  background: #0088cc;
  color: white;
  font-weight: 600;
  font-family: 'IRANSans';
}

/* Popups Welcome */
#welcomePopup {
  position:fixed; inset:0; display:grid; place-items:center; background:rgba(0,0,0,0.5); z-index:999;
}
#welcomePopup .popupContent {
  background: var(--day-card);
  padding:20px;
  border-radius:12px;
  text-align:center;
  max-width:350px;
  width:90%;
}
body.theme-dark #welcomePopup .popupContent {
  background: var(--night-card);
  color: var(--text-night);
}

/* Responsive Actions */
@media(max-width:768px){
  .actions { flex-direction:row; justify-content:space-between; }
  .actions .btn { flex:1; justify-content:center; }
}
</style>
</head>
<body>

<header class="header">
  <div class="brand">
    <div class="brand-main">
      <div class="logo">
        <img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg" alt="Telegram" style="width:28px;height:28px;">
      </div>
      <div>
        دنیای بدون مرز تلگرام
        <div class="brand-sub">Published by Hamid Ahmadloo</div>
      </div>
    </div>
  </div>
  <button id="themeToggle" class="btn">حالت شب/روز</button>
</header>

<div class="tabs">
  <div class="tab active" data-tab="mtproto">MTProto</div>
  <div class="tab" data-tab="socks">SOCKS5</div>
</div>

<div class="stats" id="tabStats"></div>
<div class="grid" id="cardsContainer"></div>
<div class="pagination" id="pagination"></div>

<footer class="footer">
   <a href="https://mtpro.xyz/" target="_blank">Proxy Monitoring</a> Powered by
</footer>

<div id="welcomePopup">
  <div class="popupContent">
    <h2>خوش آمدید!</h2>
    <p>به دنیای بدون مرز تلگرام خوش آمدید. تمام پروکسی‌ها را مشاهده و استفاده کنید.</p>
    <button class="btn-welcome" onclick="closeWelcome()">ادامه</button>
  </div>
</div>

<div id="qrModal">
  <div class="popupContent">
    <div id="qrBox"></div>
    <button onclick="closeQR()">بستن</button>
  </div>
</div>

<script>
let currentTheme = localStorage.getItem('theme') || 'day';
const root = document.body;
const themeToggle = document.getElementById('themeToggle');
function applyTheme(theme){
  currentTheme = theme;
  root.classList.toggle('theme-dark', theme==='night');
  localStorage.setItem('theme', theme);
}
themeToggle.addEventListener('click', ()=> applyTheme(currentTheme==='day'?'night':'day'));
applyTheme(currentTheme);

// Tabs
const tabs = document.querySelectorAll('.tab');
let activeTab = 'mtproto';
tabs.forEach(tab=>tab.addEventListener('click', ()=>{
  tabs.forEach(t=>t.classList.remove('active'));
  tab.classList.add('active');
  activeTab = tab.dataset.tab;
  currentPage = 1;
  renderPage();
}));

const API_BASE = 'https://mtpro.xyz';
async function fetchJSON(url){
  const res = await fetch(url);
  if(!res.ok) throw new Error(res.statusText);
  return res.json();
}

const perPage = 30;
let currentPage = 1;
let mtprotoList = [];
let socksList = [];

function sortList(list){
  return list.sort((a,b)=>{ const pa=a.ping??1e9,pb=b.ping??1e9; return pa-pb; });
}

function countryFlag(code){
  if(!code) return '';
  return `<span class="fi fi-${code.toLowerCase()}"></span>`;
}

function buildCard(item,type){
  const isMT = type==='mtproto';
  const title = isMT? item.host:item.ip;
  const port = item.port;
  const provider = item.provider;
  const country = item.country||'—';
  const addTime = item.addTime;
  const updateTime = item.updateTime;
  const ping = item.ping??'—';
  const uptime = item.uptime;

  const tgLink = isMT ? `tg://proxy?server=${item.host}&port=${port}&secret=${item.secret}`
                      : `tg://socks?server=${item.ip}&port=${port}`;
  const copyText = isMT? `mtproto://${item.host}:${port}?secret=${item.secret}` : `socks5://${item.ip}:${port}`;

  const card = document.createElement('div');
  card.className = 'card';
  card.innerHTML = `
    <div class="card-header">
      <span class="badge">${isMT?'MTProto':'SOCKS5'}</span>
      <strong>${title}</strong>:<span>${port}</span>
    </div>
    <div class="kvs">
      <div class="kv">کشور: ${country} ${countryFlag(country)}</div>
      <div class="kv">ارائه‌دهنده: ${provider}</div>
      ${isMT?`<div class="kv">آپتایم: ${uptime??'—'}%</div>`:''}
      <div class="kv">پینگ: ${ping}</div>
      <div class="kv">ایجاد: ${new Date(addTime*1000).toLocaleString()}</div>
      ${updateTime?`<div class="kv">بروزرسانی: ${new Date(updateTime*1000).toLocaleString()}</div>`:''}
    </div>
    <div class="actions">
      <a class="btn btn-connect" style="background:${currentTheme==='day'? 'var(--btn-connect-day)': 'var(--btn-connect-night)'}" href="${tgLink}" target="_blank">اتصال</a>
      <button class="btn btn-copy" data-copy="${copyText}" style="background:${currentTheme==='day'? 'var(--btn-copy-day)': 'var(--btn-copy-night)'}">کپی</button>
      <button class="btn btn-qr" data-qr="${tgLink}" style="background:${currentTheme==='day'? 'var(--btn-qr-day)': 'var(--btn-qr-night)'}">QR</button>
    </div>
  `;
  card.querySelector('.btn-copy').addEventListener('click', e=>{
    navigator.clipboard.writeText(e.currentTarget.dataset.copy);
    e.currentTarget.textContent='کپی شد';
    setTimeout(()=>{e.currentTarget.innerHTML='کپی';},1500);
  });
  card.querySelector('.btn-qr').addEventListener('click', e=>{ openQR(e.currentTarget.dataset.qr); });
  return card;
}

function renderPage(){
  const list = activeTab==='mtproto'? mtprotoList: socksList;
  const total = list.length;
  const start = (currentPage-1)*perPage;
  const end = start+perPage;
  const pageItems = list.slice(start,end);
  const container = document.getElementById('cardsContainer');
  container.innerHTML='';
  pageItems.forEach(item=>container.appendChild(buildCard(item,activeTab)));

  const pages = Math.ceil(total/perPage);
  const pagEl = document.getElementById('pagination');
  pagEl.innerHTML='';
  if(pages<=1) return;
  if(currentPage>1){
    const prev = document.createElement('button'); 
    prev.innerHTML='قبلی';
    prev.className='page-btn '+currentTheme;
    prev.onclick=()=>{currentPage--;renderPage();};
    pagEl.appendChild(prev);
  }
  if(currentPage<pages){
    const next = document.createElement('button'); 
    next.innerHTML='بعدی';
    next.className='page-btn '+currentTheme;
    next.onclick=()=>{currentPage++;renderPage();};
    pagEl.appendChild(next);
  }

  const statEl = document.getElementById('tabStats');
  statEl.innerHTML=`<div class="stat">تعداد: ${total}</div>`;
}

// QR Modal with drag & animation
function openQR(text){
  const modal = document.getElementById('qrModal');
  const popup = modal.querySelector('.popupContent');
  const qrBox = document.getElementById('qrBox');

  qrBox.innerHTML='';
  new QRCode(qrBox, {text, width:220, height:220});

  modal.style.display = 'grid';
  popup.style.transition = 'transform 0.3s ease, opacity 0.3s ease';
  popup.style.transform = 'scale(0.7)';
  popup.style.opacity = '0';
  setTimeout(()=>{
    popup.style.transform = 'scale(1)';
    popup.style.opacity = '1';
  }, 10);

  modal.addEventListener('click', function(e){
    if(e.target === modal) closeQR();
  });

  let startY = 0, currentY = 0, isDragging = false;
  const maxDrag = 150;

  function dragStart(e){
    isDragging = true;
    startY = e.type.includes('mouse') ? e.clientY : e.touches[0].clientY;
    popup.style.transition = 'none';
  }

  function dragMove(e){
    if(!isDragging) return;
    currentY = e.type.includes('mouse') ? e.clientY : e.touches[0].clientY;
    let delta = currentY - startY;
    delta = Math.max(-maxDrag, Math.min(delta, maxDrag));
    popup.style.transform = `translateY(${delta}px) scale(${1 - Math.abs(delta)/800})`;
    popup.style.opacity = `${1 - Math.abs(delta)/400}`;
  }

  function dragEnd(){
    if(!isDragging) return;
    let delta = currentY - startY;
    isDragging = false;
    popup.style.transition = 'transform 0.3s ease, opacity 0.3s ease';
    if(Math.abs(delta) > maxDrag/2){
      closeQR();
    } else {
      popup.style.transform = 'scale(1)';
      popup.style.opacity = '1';
    }
  }

  popup.addEventListener('mousedown', dragStart);
  popup.addEventListener('touchstart', dragStart);
  window.addEventListener('mousemove', dragMove);
  window.addEventListener('touchmove', dragMove);
  window.addEventListener('mouseup', dragEnd);
  window.addEventListener('touchend', dragEnd);
}

function closeQR(){
  const modal = document.getElementById('qrModal');
  const popup = modal.querySelector('.popupContent');
  popup.style.transform = 'scale(0.7)';
  popup.style.opacity = '0';
  modal.style.opacity = '0';
  setTimeout(()=>{
    modal.style.display = 'none';
    document.getElementById('qrBox').innerHTML='';
    popup.style.transform = '';
    popup.style.opacity = '';
    modal.style.opacity = '';
  }, 300);
}

function closeWelcome(){ document.getElementById('welcomePopup').style.display='none'; }

(async function(){
  try{
    const [mt,socks] = await Promise.all([
      fetchJSON(`${API_BASE}/api/?type=mtproto`),
      fetchJSON(`${API_BASE}/api/?type=socks`)
    ]);
    mtprotoList = sortList(mt);
    socksList = sortList(socks);
    renderPage();
  }catch(err){
    console.error(err);
    document.getElementById('cardsContainer').innerHTML='<p>خطا در دریافت اطلاعات.</p>';
  }
})();
</script>
</body>
</html>
