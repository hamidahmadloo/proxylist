<!doctype html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>دنیای بدون مرز تلگرام</title>

<!-- Fonts -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous">
<link href="https://cdn.jsdelivr.net/gh/rastikerdar/iransans@v6.0.1/dist/font-face.css" rel="stylesheet">

<!-- QRCode library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
:root {
  --c1: #B1B2FF; --c2: #AAC4FF; --c3: #D2DAFF; --c4: #EEF1FF;
  --text: #0f172a; --muted: #475569;
  --btn-connect: #4f46e5; --btn-copy: #059669; --btn-qr: #0ea5e9;
  --shadow: 0 10px 30px rgba(2,6,23,.12);
}
:root.theme-dark {
  --c1: #404258; --c2: #474E68; --c3: #50577A; --c4: #6B728E;
  --text: #f8fafc; --muted: #cbd5e1;
  --btn-connect: #818cf8; --btn-copy: #34d399; --btn-qr: #38bdf8;
  --shadow: 0 10px 30px rgba(15,23,42,.35);
}
body { margin:0; font-family: IRANSans,sans-serif; background: var(--c4); color: var(--text); }
.header { position: sticky; top:0; background: var(--c4); padding: 16px; display: flex; align-items:center; gap:12px; justify-content: space-between; }
.brand { display:flex; align-items:center; gap:10px; font-weight:700; font-size:20px; }
.brand .logo { width:36px; height:36px; display:grid; place-items:center; background: #25A6E9; color:white; border-radius:8px; }
.controls { display:flex; gap:10px; }
.btn { padding:8px 14px; border:none; border-radius:12px; cursor:pointer; display:flex; align-items:center; gap:6px; font-family: IRANSans,sans-serif; }
.btn:hover { filter: brightness(1.05); }
.grid { display:grid; grid-template-columns: repeat(auto-fill,minmax(280px,1fr)); gap:16px; padding:16px; }
.card { border-radius:16px; background: var(--c3); padding:16px; box-shadow: var(--shadow); display:grid; gap:10px; }
.card-header { display:flex; align-items:center; gap:10px; }
.actions { display:flex; gap:8px; flex-wrap:wrap; }
.modal { position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.5); }
.modal.show { display:grid; }
.modal-card { background: var(--c4); padding:20px; border-radius:16px; }
.footer { text-align:center; padding:20px; color: var(--muted); }
</style>
</head>
<body>
<header class="header">
  <div class="brand">
    <div class="logo"><i class="fa-brands fa-telegram-plane"></i></div>
    دنیای بدون مرز تلگرام
  </div>
  <div class="controls">
    <button id="themeToggle" class="btn"><i class="fa-solid fa-moon"></i> حالت شب/روز</button>
    <button id="refreshBtn" class="btn"><i class="fa-solid fa-arrows-rotate"></i> بروزرسانی</button>
  </div>
</header>
<main>
  <div id="mtGrid" class="grid"></div>
  <div id="socksGrid" class="grid"></div>
</main>
<footer class="footer">
  ارائه دهنده <a href="https://t.me/hamid_ahmadloo" target="_blank"><i class="fa-brands fa-telegram"></i> @Hamid_Ahmadloo</a>
</footer>

<div class="modal" id="qrModal">
  <div class="modal-card">
    <div id="qrBox"></div>
    <button id="qrClose">بستن</button>
  </div>
</div>

<script>
const mtGrid = document.getElementById('mtGrid');
const socksGrid = document.getElementById('socksGrid');
const themeToggle = document.getElementById('themeToggle');
const refreshBtn = document.getElementById('refreshBtn');
const qrModal = document.getElementById('qrModal');
const qrBox = document.getElementById('qrBox');
const qrClose = document.getElementById('qrClose');

const API_BASE = 'http://localhost:3000/proxy';

function tgLinkMt(item){ return `tg://proxy?server=${encodeURIComponent(item.host)}&port=${item.port}&secret=${item.secret}`; }
function tgLinkSocks(item){ return `tg://socks?server=${encodeURIComponent(item.ip)}&port=${item.port}`; }

function buildCard(item){
  const isMT = !!item.secret;
  const card = document.createElement('div');
  card.className='card';
  card.innerHTML=`
    <div class="card-header">
      <strong>${isMT?item.host:item.ip}:${item.port}</strong>
    </div>
    <div>کشور: ${item.country} <span>${item.country}</span></div>
    <div>ارائه دهنده: ${item.provider}</div>
    <div>پینگ: ${item.ping}</div>
    <div>ایجاد: ${item.addTime}</div>
    ${isMT?`<div>آپتایم: ${item.uptime}</div>`:''}
    ${isMT?`<div>به‌روزرسانی: ${item.updateTime}</div>`:''}
    <div class="actions">
      <a class="btn" href="${isMT?tgLinkMt(item):tgLinkSocks(item)}" target="_blank">اتصال</a>
      <button class="btn" onclick="navigator.clipboard.writeText('${isMT?`mtproto://${item.host}:${item.port}?secret=${item.secret}`:`socks5://${item.ip}:${item.port}`}')">کپی</button>
      <button class="btn" onclick="openQR('${isMT?tgLinkMt(item):tgLinkSocks(item)}')">کیوآر</button>
    </div>`;
  return card;
}

function openQR(text){ qrModal.classList.add('show'); qrBox.innerHTML=''; new QRCode(qrBox,{text,width:240,height:240}); }
function closeQR(){ qrModal.classList.remove('show'); qrBox.innerHTML=''; }
qrClose.addEventListener('click', closeQR);
qrModal.addEventListener('click', e=>{if(e.target===qrModal) closeQR();});

async function fetchProxies(){
  try{
    const [mtRes,socksRes] = await Promise.all([
      fetch(`${API_BASE}?type=mtproto`),
      fetch(`${API_BASE}?type=socks`)
    ]);
    const mtData = await mtRes.json();
    const socksData = await socksRes.json();
    mtGrid.innerHTML=''; socksGrid.innerHTML='';
    mtData.forEach(x=>mtGrid.appendChild(buildCard(x)));
    socksData.forEach(x=>socksGrid.appendChild(buildCard(x)));
  }catch(e){ alert('خطا در دریافت اطلاعات'); console.error(e); }
}

themeToggle.addEventListener('click',()=>{document.documentElement.classList.toggle('theme-dark');});
refreshBtn.addEventListener('click', fetchProxies);

fetchProxies();
</script>
</body>
</html>
